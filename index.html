<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sistema de Agendamento - Professores</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">
  <div id="root"></div>
  <script type="text/babel">
    const { useState } = React;

    // üîó URL real do Apps Script
    const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwPeLttfmp4FTREhz3pWutsO4FhEPSk7kSMHt5rJO-kbBQWqUkKEi-m97omGJDItDYk/exec";

    // Disciplinas e professores
    const subjects = {
      "L√≠ngua Portuguesa e Reda√ß√£o": {
        icon: "üìö",
        teachers: [
          "Prof¬™. Juliana Tricot",
          "Prof¬™. Juliana Velho",
          "Prof¬™. Daniella",
          "Prof¬™. M√°rcia"
        ]
      },
      Matem√°tica: {
        icon: "üßÆ",
        teachers: [
          "Prof¬™. Aline",
          "Prof¬™. Eliana",
          "Prof¬™. K√°tya",
          "Prof. Mateus",
          "Prof¬™. Michele"
        ]
      },
      "Ci√™ncias e Qu√≠mica": {
        icon: "üî¨",
        teachers: [
          "Prof¬™. Karina",
          "Prof¬™. Raquel",
          "Prof¬™. Roberta",
          "Prof¬™. Tarine"
        ]
      },
      Ingl√™s: {
        icon: "üî§",
        teachers: [
          "Prof¬™. Bianca",
          "Prof¬™. Giane",
          "Prof. Leonardo",
          "Prof. Everton"
        ]
      }
    };

    // Gera√ß√£o dos hor√°rios
    const generateTimeSlots = () => {
      const slots = [];
      let start = new Date();
      start.setHours(18, 30, 0, 0);
      const end = new Date();
      end.setHours(19, 50, 0, 0);

      while (start <= end) {
        slots.push(
          start.toLocaleTimeString("pt-BR", {
            hour: "2-digit",
            minute: "2-digit",
            hour12: false,
          })
        );
        start.setMinutes(start.getMinutes() + 10);
      }
      return slots;
    };
    const timeSlots = generateTimeSlots();

    // Fun√ß√£o para salvar no Apps Script
    const saveBookingToAppsScript = async (bookingData) => {
      try {
        const response = await fetch(APPS_SCRIPT_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(bookingData),
        });
        const result = await response.json();
        if (!result.success) throw new Error(result.error || "Erro ao salvar");
        return true;
      } catch (err) {
        console.error("Erro ao salvar:", err);
        return false;
      }
    };

    // Componente principal
    function App() {
      const [screen, setScreen] = useState("subjects");
      const [subject, setSubject] = useState("");
      const [teacher, setTeacher] = useState("");
      const [time, setTime] = useState("");
      const [parentName, setParentName] = useState("");
      const [studentName, setStudentName] = useState("");
      const [email, setEmail] = useState("");
      const [message, setMessage] = useState("");

      const handleBooking = async (e) => {
        e.preventDefault();
        const bookingData = {
          teacher,
          subject,
          parentName,
          studentName,
          email,
          time,
          bookingDate: new Date().toLocaleDateString("pt-BR"),
        };
        const success = await saveBookingToAppsScript(bookingData);
        if (success) {
          setMessage(`‚úÖ Agendamento confirmado para ${teacher} √†s ${time}`);
          setTimeout(() => {
            setScreen("subjects");
            setTeacher("");
            setSubject("");
            setTime("");
            setParentName("");
            setStudentName("");
            setEmail("");
            setMessage("");
          }, 2500);
        } else {
          setMessage("‚ùå Erro ao salvar. Tente novamente.");
        }
      };

      if (screen === "subjects") {
        return (
          <div className="p-6">
            <div className="max-w-4xl mx-auto bg-white rounded-2xl shadow-xl p-8">
              <h2 className="text-2xl font-bold text-center mb-6">
                1. Selecione a Mat√©ria
              </h2>
              <div className="grid grid-cols-2 md:grid-cols-3 gap-6">
                {Object.entries(subjects).map(([name, data]) => (
                  <button
                    key={name}
                    onClick={() => {
                      setSubject(name);
                      setScreen("teachers");
                    }}
                    className="bg-gray-100 rounded-xl p-6 shadow hover:shadow-lg text-center"
                  >
                    <div className="text-4xl">{data.icon}</div>
                    <p className="mt-2 font-semibold">{name}</p>
                  </button>
                ))}
              </div>
            </div>
          </div>
        );
      }

      if (screen === "teachers") {
        return (
          <div className="p-6">
            <div className="max-w-4xl mx-auto bg-white rounded-2xl shadow-xl p-8">
              <button
                onClick={() => setScreen("subjects")}
                className="mb-4 text-gray-600"
              >
                ‚Üê Voltar
              </button>
              <h2 className="text-2xl font-bold text-center mb-6">
                2. Selecione o Professor ({subject})
              </h2>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                {subjects[subject].teachers.map((t) => (
                  <button
                    key={t}
                    onClick={() => {
                      setTeacher(t);
                      setScreen("booking");
                    }}
                    className="bg-gray-100 rounded-xl p-6 shadow hover:shadow-lg text-center"
                  >
                    <p className="font-semibold">{t}</p>
                  </button>
                ))}
              </div>
            </div>
          </div>
        );
      }

      if (screen === "booking") {
        return (
          <div className="p-6">
            <div className="max-w-xl mx-auto bg-white rounded-2xl shadow-xl p-8">
              <button
                onClick={() => setScreen("teachers")}
                className="mb-4 text-gray-600"
              >
                ‚Üê Voltar
              </button>
              <h2 className="text-2xl font-bold text-center mb-6">
                3. Agende seu Hor√°rio
              </h2>
              <p className="text-center mb-4">
                Professor: <b>{teacher}</b> <br />
                Disciplina: <b>{subject}</b>
              </p>
              <form onSubmit={handleBooking} className="space-y-4">
                <select
                  value={time}
                  onChange={(e) => setTime(e.target.value)}
                  className="w-full p-3 border rounded-lg"
                  required
                >
                  <option value="">Selecione o hor√°rio</option>
                  {timeSlots.map((slot) => (
                    <option key={slot} value={slot}>
                      {slot}
                    </option>
                  ))}
                </select>
                <input
                  type="text"
                  placeholder="Nome do Respons√°vel"
                  value={parentName}
                  onChange={(e) => setParentName(e.target.value)}
                  className="w-full p-3 border rounded-lg"
                  required
                />
                <input
                  type="text"
                  placeholder="Nome do Estudante"
                  value={studentName}
                  onChange={(e) => setStudentName(e.target.value)}
                  className="w-full p-3 border rounded-lg"
                  required
                />
                <input
                  type="email"
                  placeholder="Email"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  className="w-full p-3 border rounded-lg"
                  required
                />
                <button
                  type="submit"
                  className="w-full py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700"
                >
                  Confirmar Agendamento
                </button>
              </form>
              {message && (
                <p className="mt-4 text-center text-sm text-gray-700">{message}</p>
              )}
            </div>
          </div>
        );
      }
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>
