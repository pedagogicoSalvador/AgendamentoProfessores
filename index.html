<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Agendamento - Professores</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

    // ✅ Substitua pela SUA URL do Apps Script
    const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwzEsOINnFdDFryoOTg6HAp-fWMgc8BoPEbrmHxb4jjrMW7g-DIci29k6jX3vtVPR_k/exec";

    function App() {
      const [agendamentos, setAgendamentos] = useState([]);
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState("");
      const [form, setForm] = useState({
        teacher: "",
        subject: "",
        parentName: "",
        studentName: "",
        email: "",
        time: "",
        bookingDate: new Date().toLocaleDateString("pt-BR")
      });

      // 🔹 Carregar agendamentos do Google Sheets
      async function loadAgendamentos() {
        try {
          setLoading(true);
          const response = await fetch(APPS_SCRIPT_URL);
          const data = await response.json();
          if (data.success) {
            setAgendamentos(data.data);
          } else {
            setError("Erro ao carregar dados: " + data.error);
          }
        } catch (err) {
          console.error("Erro no fetch:", err);
          setError("Falha de conexão com o servidor.");
        } finally {
          setLoading(false);
        }
      }

      // 🔹 Enviar novo agendamento
      async function salvarAgendamento(e) {
        e.preventDefault();
        try {
          setLoading(true);
          const response = await fetch(APPS_SCRIPT_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(form)
          });
          const data = await response.json();
          if (data.success) {
            alert("✅ Agendamento salvo com sucesso!");
            loadAgendamentos();
          } else {
            alert("⚠️ Erro: " + data.error);
          }
        } catch (err) {
          console.error("Erro no POST:", err);
          alert("❌ Falha ao salvar agendamento.");
        } finally {
          setLoading(false);
        }
      }

      useEffect(() => {
        loadAgendamentos();
      }, []);

      return (
        <div className="max-w-4xl mx-auto p-6">
          <h1 className="text-3xl font-bold mb-6 text-center">📅 Sistema de Agendamento</h1>

          {/* Formulário */}
          <form onSubmit={salvarAgendamento} className="bg-white p-6 rounded-lg shadow mb-8">
            <h2 className="text-xl font-semibold mb-4">Novo Agendamento</h2>
            <input
              className="w-full p-2 border rounded mb-3"
              placeholder="Professor"
              value={form.teacher}
              onChange={e => setForm({ ...form, teacher: e.target.value })}
              required
            />
            <input
              className="w-full p-2 border rounded mb-3"
              placeholder="Disciplina"
              value={form.subject}
              onChange={e => setForm({ ...form, subject: e.target.value })}
              required
            />
            <input
              className="w-full p-2 border rounded mb-3"
              placeholder="Nome do Responsável"
              value={form.parentName}
              onChange={e => setForm({ ...form, parentName: e.target.value })}
              required
            />
            <input
              className="w-full p-2 border rounded mb-3"
              placeholder="Nome do Estudante"
              value={form.studentName}
              onChange={e => setForm({ ...form, studentName: e.target.value })}
              required
            />
            <input
              className="w-full p-2 border rounded mb-3"
              type="email"
              placeholder="Email"
              value={form.email}
              onChange={e => setForm({ ...form, email: e.target.value })}
              required
            />
            <input
              className="w-full p-2 border rounded mb-3"
              placeholder="Horário (ex: 18:30)"
              value={form.time}
              onChange={e => setForm({ ...form, time: e.target.value })}
              required
            />
            <button
              type="submit"
              className="w-full bg-indigo-600 text-white py-2 rounded hover:bg-indigo-700"
              disabled={loading}
            >
              {loading ? "Salvando..." : "Salvar Agendamento"}
            </button>
          </form>

          {/* Lista de agendamentos */}
          <div className="bg-white p-6 rounded-lg shadow">
            <h2 className="text-xl font-semibold mb-4">📋 Agendamentos Registrados</h2>
            {error && <p className="text-red-600 mb-3">{error}</p>}
            {loading && <p className="text-gray-600">Carregando...</p>}
            {!loading && agendamentos.length > 1 && (
              <table className="min-w-full text-sm border">
                <thead className="bg-gray-200">
                  <tr>
                    <th className="p-2 border">Professor</th>
                    <th className="p-2 border">Disciplina</th>
                    <th className="p-2 border">Responsável</th>
                    <th className="p-2 border">Estudante</th>
                    <th className="p-2 border">Email</th>
                    <th className="p-2 border">Horário</th>
                    <th className="p-2 border">Data</th>
                  </tr>
                </thead>
                <tbody>
                  {agendamentos.slice(1).map((row, idx) => (
                    <tr key={idx} className="odd:bg-gray-50">
                      {row.map((col, i) => (
                        <td key={i} className="p-2 border">{col}</td>
                      ))}
                    </tr>
                  ))}
                </tbody>
              </table>
            )}
            {!loading && agendamentos.length <= 1 && (
              <p className="text-gray-500">Nenhum agendamento registrado ainda.</p>
            )}
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>
